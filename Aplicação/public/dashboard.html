<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DashBoard - Djavan</title>
  <link rel="stylesheet" href="css/dash.css">
</head>

<body>
  <div id="menu">
    <div id="menu-bar" onclick="menuOnClick()">
      <div id="bar1" class="bar"></div>
      <div id="bar2" class="bar"></div>
      <div id="bar3" class="bar"></div>
    </div>
    <nav class="nav" id="nav">
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="quiz.html">Quiz</a></li>
        <li><a href="dashboard.html">Dashboard</a></li>
        <li><a href="#">Playlist</a></li>
        <li><a href="#">Sair</a></li>
      </ul>
    </nav>
  </div>
  
  <div class="menu-bg" id="menu-bg"></div>

  <div class="dash">
    <div class="tela-grafico">
      <div class="titulo-grafico">
        <p>Informa√ß√µes Gerais</p>
      </div>
      <div class="kpi-grafico">
        <div class="kpi1">
          <span>Sua √öltima Pontua√ß√£o:</span>
          <span><span id="ultimaPontuacao">0</span> de 15 pontos</span>
        </div>
        <div class="kpi2">
          <span>Pontua√ß√£o M√©dia dos Jogadores:</span>
          <span id="mediaPontuacaoJogador">0</span>
        </div>
        <div class="kpi3">
          <span>Top 3 Pontuadores:</span>
          <ul id="top3Pontuadores"></ul>
        </div>
      </div>
      <div class="card-grafico">
        <div class="titulo-grafico">
          <p>Pontua√ß√£o dos Jogadores</p>
        </div>
        <div class="dados-grafico">
          <canvas id="myChart2"></canvas>
          <canvas id="graficoJogadores"></canvas>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Menu Toggle
    function menuOnClick() {
      document.getElementById("menu-bar").classList.toggle("change");
      document.getElementById("nav").classList.toggle("change");
      document.getElementById("menu-bg").classList.toggle("change-bg");
    }

    // Exibir a √∫ltima pontua√ß√£o do usu√°rio
    const pontuacao = sessionStorage.getItem('Pontos');
  if (pontuacao == null) {
    document.getElementById('ultimaPontuacao').innerHTML = '0';
  } else {
    document.getElementById('ultimaPontuacao').innerHTML = pontuacao;
  }

    console.log('Pontua√ß√£o:', pontuacao);

    // Obter m√©dia de pontua√ß√£o dos jogadores
    fetch('/quiz/listarPontos')
      .then(response => response.json())
      .then(data => {
        const media = data[0]?.['avg(pontos)'] || 0;
        document.getElementById('mediaPontuacaoJogador').innerText = parseFloat(media).toFixed(2);
      })
      .catch(error => console.error('Erro ao buscar m√©dia de pontua√ß√£o:', error));

    // Buscar top 3 pontuadores
    fetch('/grafico/buscarMelhoresPontuadores')
      .then(response => response.json())
      .then(data => {
        const top3List = document.getElementById('top3Pontuadores');
        top3List.innerHTML = '';

        data.slice(0, 3).forEach((player, index) => {
          const listItem = document.createElement('li');
          const medalha = ['ü•á', 'ü•à', 'ü•â'][index] || '';
          listItem.innerHTML = `${medalha} ${player.nome_jogador}: ${player.pontos} pontos`;
          top3List.appendChild(listItem);
        });
      })
      .catch(error => console.error('Erro ao buscar top 3 pontuadores:', error));

    // Plotar gr√°fico de desempenho geral
    fetch('/grafico/buscarPontuacao')
      .then(response => response.json())
      .then(data => {
        const chartData = {
          labels: ['Quiz'],
          datasets: [
            { label: 'Turista', data: [data[0]?.Ruim || 0], backgroundColor: '#4D5359' },
            { label: 'Ok', data: [data[0]?.Ok || 0], backgroundColor: '#C9CEBD' },
            { label: 'Djaf√£', data: [data[0]?.Excelente || 0], backgroundColor: '#50080b' },
          ],
        };
        new Chart(document.getElementById('myChart2'), { type: 'bar', data: chartData });
      })
      .catch(error => console.error('Erro ao buscar dados para gr√°fico:', error));

    // Plotar gr√°fico de pontua√ß√£o dos jogadores
    fetch('/grafico/buscarJogadoresPontuacoes')
      .then(response => response.json())
      .then(data => {
        const jogadores = data.map(item => item.nome_jogador);
        const pontuacoes = data.map(item => item.pontos);

        const chartData = {
          labels: jogadores,
          datasets: [{ label: 'Pontua√ß√£o dos jogadores', data: pontuacoes, backgroundColor: '#50080b' }],
        };
        new Chart(document.getElementById('graficoJogadores'), { type: 'bar', data: chartData });
      })
      .catch(error => console.error('Erro ao buscar pontua√ß√£o dos jogadores:', error));
  </script>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</body>

</html>

